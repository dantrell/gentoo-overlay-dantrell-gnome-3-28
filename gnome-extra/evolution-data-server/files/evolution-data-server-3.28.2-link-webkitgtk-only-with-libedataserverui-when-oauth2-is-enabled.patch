From 385efcb0b292094eb08fdf22f2df918cc7a6e3c0 Mon Sep 17 00:00:00 2001
From: Milan Crha <mcrha@redhat.com>
Date: Thu, 19 Apr 2018 16:26:39 +0200
Subject: Link WebKitGTK+ only with libedataserverui when OAuth2 is enabled

---
 CMakeLists.txt                      | 7 +++++--
 src/libedataserver/CMakeLists.txt   | 6 +++---
 src/libedataserverui/CMakeLists.txt | 9 ++++++---
 3 files changed, 14 insertions(+), 8 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index c1e0386..9b1513d 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -388,11 +388,14 @@ endif(ENABLE_GTK)
 add_printable_option(ENABLE_OAUTH2 "Enable built-in OAuth2 authentications" ON)
 
 if(ENABLE_OAUTH2)
-	pkg_check_modules_for_option(ENABLE_OAUTH2 "OAuth2 authentication support" OAUTH2
-		webkit2gtk-4.0>=${webkit2gtk_minimum_version}
+	pkg_check_modules_for_option(ENABLE_OAUTH2 "OAuth2 authentication support" OAUTH2_JSON_GLIB
 		json-glib-1.0>=${json_glib_minimum_version}
 	)
 
+	pkg_check_modules_for_option(ENABLE_OAUTH2 "OAuth2 authentication support" OAUTH2_WEBKIT2GTK
+		webkit2gtk-4.0>=${webkit2gtk_minimum_version}
+	)
+
 	add_printable_variable(WITH_GOOGLE_CLIENT_ID "Google OAuth 2.0 client id" "")
 	add_printable_variable(WITH_GOOGLE_CLIENT_SECRET "Google OAuth 2.0 client secret" "")
 
diff --git a/src/libedataserver/CMakeLists.txt b/src/libedataserver/CMakeLists.txt
index 62f10f7..f4e7caa 100644
--- a/src/libedataserver/CMakeLists.txt
+++ b/src/libedataserver/CMakeLists.txt
@@ -253,7 +253,7 @@ target_compile_options(edataserver PUBLIC
 	${GCR_BASE_CFLAGS}
 	${GIO_UNIX_CFLAGS}
 	${ICU_CFLAGS}
-	${OAUTH2_CFLAGS}
+	${OAUTH2_JSON_GLIB_CFLAGS}
 	${LIBGDATA_CFLAGS}
 )
 
@@ -268,7 +268,7 @@ target_include_directories(edataserver PUBLIC
 	${GCR_BASE_INCLUDE_DIRS}
 	${GIO_UNIX_INCLUDE_DIRS}
 	${ICU_INCLUDE_DIRS}
-	${OAUTH2_INCLUDE_DIRS}
+	${OAUTH2_JSON_GLIB_INCLUDE_DIRS}
 	${LIBGDATA_INCLUDE_DIRS}
 )
 
@@ -278,7 +278,7 @@ target_link_libraries(edataserver
 	${GCR_BASE_LDFLAGS}
 	${GIO_UNIX_LDFLAGS}
 	${ICU_LDFLAGS}
-	${OAUTH2_LDFLAGS}
+	${OAUTH2_JSON_GLIB_LDFLAGS}
 	${LIBGDATA_LDFLAGS}
 )
 
diff --git a/src/libedataserverui/CMakeLists.txt b/src/libedataserverui/CMakeLists.txt
index e6d45ee..f039ff0 100644
--- a/src/libedataserverui/CMakeLists.txt
+++ b/src/libedataserverui/CMakeLists.txt
@@ -56,7 +56,8 @@ target_compile_options(edataserverui PUBLIC
 	${GCR_BASE_CFLAGS}
 	${GCR_CFLAGS}
 	${GTK_CFLAGS}
-	${OAUTH2_CFLAGS}
+	${OAUTH2_JSON_GLIB_CFLAGS}
+	${OAUTH2_WEBKIT2GTK_CFLAGS}
 )
 
 target_include_directories(edataserverui PUBLIC
@@ -72,7 +73,8 @@ target_include_directories(edataserverui PUBLIC
 	${GCR_BASE_INCLUDE_DIRS}
 	${GCR_INCLUDE_DIRS}
 	${GTK_INCLUDE_DIRS}
-	${OAUTH2_INCLUDE_DIRS}
+	${OAUTH2_JSON_GLIB_INCLUDE_DIRS}
+	${OAUTH2_WEBKIT2GTK_INCLUDE_DIRS}
 )
 
 target_link_libraries(edataserverui
@@ -85,7 +87,8 @@ target_link_libraries(edataserverui
 	${GCR_BASE_LDFLAGS}
 	${GCR_LDFLAGS}
 	${GTK_LDFLAGS}
-	${OAUTH2_LDFLAGS}
+	${OAUTH2_JSON_GLIB_LDFLAGS}
+	${OAUTH2_WEBKIT2GTK_LDFLAGS}
 )
 
 install(TARGETS edataserverui
-- 
cgit v0.12

